"use strict";const{app:o,BrowserWindow:s,ipcMain:d,dialog:a}=require("electron"),i=require("path"),p=require("fs"),x=require("exceljs");require("electron-squirrel-startup")&&o.quit();o.disableHardwareAcceleration();o.setAppLogsPath();const f=o.requestSingleInstanceLock();f?o.on("second-instance",()=>{const[e]=s.getAllWindows();e&&(e.show(),e.focus())}):o.quit();process.on("uncaughtException",e=>{try{a.showErrorBox("Main process error",String(e?.stack||e))}catch{}o.exit(1)});process.on("unhandledRejection",e=>{try{a.showErrorBox("Main promise rejection",String(e))}catch{}o.exit(1)});function u(e){const t=o.isPackaged?process.resourcesPath:i.resolve(__dirname,"..","..");return i.join(t,e)}async function l(){const e=new s({width:1200,height:800,webPreferences:{preload:i.join(__dirname,"preload.js"),contextIsolation:!0,nodeIntegration:!1}});e.webContents.on("did-fail-load",(t,n,r)=>{try{a.showErrorBox("Window failed to load",`${n}:${r}`)}catch{}o.exit(1)}),e.webContents.on("render-process-gone",(t,n)=>{o.exit(1)}),o.on("child-process-gone",(t,n)=>{o.exit(1)}),await e.loadFile(i.join(__dirname,"../renderer/main_window/index.html"))}d.handle("load-approved-serials",async()=>{try{const e=u("input/batchall_report.xlsx"),t=new x.Workbook;await t.xlsx.readFile(e);const n=t.worksheets[0],r=[];return n.eachRow((w,h)=>{if(h>1){const c=w.getCell(1).value;c&&r.push(String(c).trim())}}),r}catch(e){return console.error("Error loading Excel:",e),[]}});d.handle("load-output-template",async()=>{const e=u("input/outputTemplate.xlsx");return p.readFileSync(e)});o.whenReady().then(()=>{l(),o.on("activate",()=>{s.getAllWindows().length===0&&l()})});o.on("window-all-closed",()=>{process.platform!=="darwin"&&o.quit()});
